name: Example - Restore to v0 in Init

on:
  workflow_dispatch:

env:
  SPRITES_TOKEN: ${{ secrets.SPRITES_TOKEN }}

jobs:
  basic-workflow:
    name: Basic Workflow
    runs-on: ubuntu-latest
    steps:
      - name: Init Sprite
        id: init
        uses: cmbrose/sprite-kit/init@v1.0.3

      - name: Step 1 - Create bad file and fail first attempt
        id: step1
        uses: cmbrose/sprite-kit/run@v1.0.3
        with:
          step-key: echo-test
          run: |
            touch bad-file

            if [ "${{ github.run_attempt }}" = "1" ]; then
              echo "First attempt - intentionally failing to test retry"
              exit 1
            fi

            rm bad-file

      - name: Step 2 - Verify bad file is gone on retry
        id: step2
        uses: cmbrose/sprite-kit/run@v1.0.3
        with:
          step-key: verify-bad-file
          run: |
            if [ -f bad-file ]; then
              echo "ERROR: bad-file still exists! Restore to v0 checkpoint failed."
              exit 1
            fi

            echo "bad-file does not exist, restore to v0 checkpoint succeeded."

      - name: Cleanup Sprite
        if: always()
        uses: cmbrose/sprite-kit/clean@v1.0.3
